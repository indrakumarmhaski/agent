'use strict';const _0x35b800=_0x54e1;(function(_0x16070a,_0x219569){const _0x419172=_0x54e1,_0x102761=_0x16070a();while(!![]){try{const _0x1b74f1=parseInt(_0x419172(0x18e))/0x1+-parseInt(_0x419172(0x158))/0x2*(parseInt(_0x419172(0x166))/0x3)+parseInt(_0x419172(0x168))/0x4+parseInt(_0x419172(0x15d))/0x5*(parseInt(_0x419172(0x187))/0x6)+-parseInt(_0x419172(0x182))/0x7+-parseInt(_0x419172(0x18b))/0x8+parseInt(_0x419172(0x160))/0x9*(parseInt(_0x419172(0x18d))/0xa);if(_0x1b74f1===_0x219569)break;else _0x102761['push'](_0x102761['shift']());}catch(_0x59e4ca){_0x102761['push'](_0x102761['shift']());}}}(_0x517e,0x91d87));function _0x517e(){const _0x405682=['throw','requestResultConfig','createBulkJobQuery','BULK_UNEXPECTED_EXCEPTION_QUERY','waitToCompleteJob','BulkJobId:\x20','BATCH_MAX_RETRY_EXCEEDED_MS','Query','abortedJob','__importDefault','InProgress','pollInterval','apply','WAITING_LIMIT_FOR_JOB','4192412XUZQRc','BATCH_MAX_RETRY_EXCEEDED_CODE','../../enums/bulk2.enums','Bulk2JobQueryState','statusBulkJobQuery','36DrMxXk','queryBuilder','stream','isExecutable','1305664GQidGJ','api','6090wpfQKc','449767zAydSR','done','execute','Failed','next','log','2089694LoqmnG','logger','Bulk2JobQueryOperation','\x20Query:\x20','instance','3085cgRPwk','getTime','jobId','17811VwoMhD','maxRecords','value','\x20Close\x20job','defineProperty','setTimeout','3kzHake','default','2982696EWMAxn','queryLocator','resultBulkQuery','../../utils/test.utils','isTest','../salesforce-error.class','query','../../services/bulk2.service','JOB_WAITING_LIMIT_MESSAGE','../../constants/salesforce.constants','Aborted','./base-retrieve-data'];_0x517e=function(){return _0x405682;};return _0x517e();}function _0x54e1(_0x50a232,_0x2a5573){const _0x517ee3=_0x517e();return _0x54e1=function(_0x54e19a,_0x430dee){_0x54e19a=_0x54e19a-0x153;let _0x4513a7=_0x517ee3[_0x54e19a];return _0x4513a7;},_0x54e1(_0x50a232,_0x2a5573);}var __awaiter=this&&this['__awaiter']||function(_0x450663,_0x5b3391,_0x5e2bf9,_0x2b972c){function _0x190582(_0x102ba0){return _0x102ba0 instanceof _0x5e2bf9?_0x102ba0:new _0x5e2bf9(function(_0x258ef8){_0x258ef8(_0x102ba0);});}return new(_0x5e2bf9||(_0x5e2bf9=Promise))(function(_0x3b46ea,_0x5c65ba){const _0x240219=_0x54e1;function _0x26f7ae(_0x3b3227){const _0x2cee85=_0x54e1;try{_0xa04a18(_0x2b972c[_0x2cee85(0x156)](_0x3b3227));}catch(_0x222371){_0x5c65ba(_0x222371);}}function _0x293f8e(_0x1e99fa){const _0x55adfb=_0x54e1;try{_0xa04a18(_0x2b972c[_0x55adfb(0x174)](_0x1e99fa));}catch(_0x34b3b4){_0x5c65ba(_0x34b3b4);}}function _0xa04a18(_0x5ac753){const _0x5ade23=_0x54e1;_0x5ac753[_0x5ade23(0x153)]?_0x3b46ea(_0x5ac753[_0x5ade23(0x162)]):_0x190582(_0x5ac753[_0x5ade23(0x162)])['then'](_0x26f7ae,_0x293f8e);}_0xa04a18((_0x2b972c=_0x2b972c[_0x240219(0x180)](_0x450663,_0x5b3391||[]))[_0x240219(0x156)]());});},__importDefault=this&&this[_0x35b800(0x17d)]||function(_0x5f4cbf){return _0x5f4cbf&&_0x5f4cbf['__esModule']?_0x5f4cbf:{'default':_0x5f4cbf};};Object[_0x35b800(0x164)](exports,'__esModule',{'value':!![]});const bulk2_service_1=__importDefault(require(_0x35b800(0x16f))),base_retrieve_data_1=__importDefault(require(_0x35b800(0x173))),bulk2_enums_1=require(_0x35b800(0x184)),test_utils_1=__importDefault(require(_0x35b800(0x16b))),salesforce_constants_1=__importDefault(require(_0x35b800(0x171))),bulk_constants_1=__importDefault(require('../../constants/bulk.constants')),salesforce_error_class_1=__importDefault(require(_0x35b800(0x16d))),promises_1=require('timers/promises');class Bulk2RetrieveData extends base_retrieve_data_1[_0x35b800(0x167)]{constructor({instance:_0x38be30,queryBuilder:_0x113d4e,pollInterval:_0x3d9fd8,maxRecords:_0x10a09b,api:_0xf7a86d,logger:_0x5b5515}){const _0x53d866=_0x35b800;super(_0x38be30,_0x113d4e,_0x5b5515),this[_0x53d866(0x17f)]=_0x3d9fd8,this[_0x53d866(0x161)]=_0x10a09b,this['api']=_0xf7a86d;}get['query'](){const _0x3fccd0=_0x35b800;return this[_0x3fccd0(0x188)]['copy']()['build'](![]);}get[_0x35b800(0x175)](){const _0x53718b=_0x35b800;return{'responseType':_0x53718b(0x189),'decompress':![]};}[_0x35b800(0x154)](){var _0x1e5e30,_0x58f475;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5690d6=_0x54e1;this[_0x5690d6(0x18a)]();if(!this['jobId']){const _0x35e061={'query':this[_0x5690d6(0x16e)],'operation':bulk2_enums_1[_0x5690d6(0x15a)][_0x5690d6(0x17b)]},{id:_0x5f5813}=yield bulk2_service_1[_0x5690d6(0x167)][_0x5690d6(0x176)](this[_0x5690d6(0x15c)],{},_0x35e061,this['api']);this[_0x5690d6(0x15f)]=_0x5f5813,(_0x1e5e30=this['logger'])===null||_0x1e5e30===void 0x0?void 0x0:_0x1e5e30[_0x5690d6(0x157)](_0x5690d6(0x179)+this[_0x5690d6(0x15f)]+'\x20Create\x20job'),(_0x58f475=this['logger'])===null||_0x58f475===void 0x0?void 0x0:_0x58f475[_0x5690d6(0x157)](_0x5690d6(0x179)+this['jobId']+_0x5690d6(0x15b)+this[_0x5690d6(0x16e)]),yield this[_0x5690d6(0x178)]();}const {records:_0x4ecb80,queryLocator:_0x432128,done:_0x1bd2ba}=yield bulk2_service_1['default'][_0x5690d6(0x16a)](this[_0x5690d6(0x15c)],this[_0x5690d6(0x175)],this[_0x5690d6(0x169)],this[_0x5690d6(0x15f)],this[_0x5690d6(0x161)],this[_0x5690d6(0x18c)]);return this['isDone']=_0x1bd2ba,this[_0x5690d6(0x169)]=_0x432128,_0x4ecb80;});}[_0x35b800(0x17c)](){var _0x2ce690;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x20582c=_0x54e1;if(!this['jobId'])return;yield bulk2_service_1[_0x20582c(0x167)][_0x20582c(0x17c)](this[_0x20582c(0x15c)],{},{'state':bulk2_enums_1['Bulk2JobQueryState'][_0x20582c(0x172)]},this['jobId'],this['api']),(_0x2ce690=this[_0x20582c(0x159)])===null||_0x2ce690===void 0x0?void 0x0:_0x2ce690['log']('BulkJobId:\x20'+this[_0x20582c(0x15f)]+_0x20582c(0x163)),this[_0x20582c(0x15f)]=null;});}['waitToCompleteJob'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x534012=_0x54e1;!test_utils_1['default'][_0x534012(0x16c)]()&&(yield(0x0,promises_1[_0x534012(0x165)])(this[_0x534012(0x17f)]));const {state:_0x12a33e,errorMessage:_0x45a23a,numberRecordsProcessed:_0x5ba1c4,createdDate:_0x552aff}=yield bulk2_service_1[_0x534012(0x167)][_0x534012(0x186)](this[_0x534012(0x15c)],{},this[_0x534012(0x15f)],this['api']);if(new Date()['getTime']()-new Date(_0x552aff)[_0x534012(0x15e)]()>bulk_constants_1[_0x534012(0x167)][_0x534012(0x181)]&&_0x5ba1c4===0x0){yield this[_0x534012(0x17c)]();throw new salesforce_error_class_1[(_0x534012(0x167))](salesforce_constants_1[_0x534012(0x167)][_0x534012(0x170)],salesforce_constants_1['default']['JOB_WAITING_LIMIT_CODE']);}switch(_0x12a33e){case bulk2_enums_1[_0x534012(0x185)][_0x534012(0x155)]:if(_0x45a23a===salesforce_constants_1[_0x534012(0x167)][_0x534012(0x17a)])throw new salesforce_error_class_1[(_0x534012(0x167))](_0x45a23a,salesforce_constants_1[_0x534012(0x167)][_0x534012(0x183)]);else{if(_0x45a23a['includes'](salesforce_constants_1[_0x534012(0x167)][_0x534012(0x177)]))throw new salesforce_error_class_1[(_0x534012(0x167))](_0x45a23a,salesforce_constants_1[_0x534012(0x167)]['BULK_UNEXPECTED_EXCEPTION_QUERY_CODE']);else throw new salesforce_error_class_1[(_0x534012(0x167))](_0x45a23a,null);}case bulk2_enums_1['Bulk2JobQueryState'][_0x534012(0x17e)]:case bulk2_enums_1['Bulk2JobQueryState']['UploadComplete']:yield this['waitToCompleteJob']();}});}}exports[_0x35b800(0x167)]=Bulk2RetrieveData;